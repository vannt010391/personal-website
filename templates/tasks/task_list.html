{% extends 'base.html' %}

{% block title %}Task List{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h1>Task List</h1>
            <a href="{% url 'tasks:dashboard' %}">&larr; Back to Dashboard</a>
        </div>
        <div style="display: flex; gap: 10px;">
            <a href="{% url 'tasks:task_kanban' %}" class="btn">Kanban View</a>
            <a href="{% url 'tasks:study_session_list' %}" class="btn">Study Sessions</a>
            <a href="{% url 'tasks:task_create' %}" class="btn btn-success">Create Task</a>
        </div>
    </div>
</div>

<div class="card">
    <h3>Filter by Status</h3>
    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
        <a href="{% url 'tasks:task_list' %}" class="btn {% if not request.GET.status %}btn-primary{% endif %}">All</a>
        <a href="?status=pending" class="btn {% if request.GET.status == 'pending' %}btn-primary{% endif %}">Pending</a>
        <a href="?status=in_progress" class="btn {% if request.GET.status == 'in_progress' %}btn-primary{% endif %}">In Progress</a>
        <a href="?status=completed" class="btn {% if request.GET.status == 'completed' %}btn-primary{% endif %}">Completed</a>
    </div>
</div>

{% if tasks %}
    <div class="card">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background-color: #F9F8F6; text-align: left;">
                    <th style="padding: 10px; border-bottom: 2px solid #D9CFC7;">Task</th>
                    <th style="padding: 10px; border-bottom: 2px solid #D9CFC7;">Type</th>
                    <th style="padding: 10px; border-bottom: 2px solid #D9CFC7;">Priority</th>
                    <th style="padding: 10px; border-bottom: 2px solid #D9CFC7;">Status</th>
                    <th style="padding: 10px; border-bottom: 2px solid #D9CFC7;">Due</th>
                    <th style="padding: 10px; border-bottom: 2px solid #D9CFC7;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for task in tasks %}
                <tr style="border-bottom: 1px solid #D9CFC7; {% if task.status == 'completed' %}opacity: 0.6;{% endif %}">
                    <td style="padding: 10px;">
                        <strong {% if task.status == 'completed' %}style="text-decoration: line-through;"{% endif %}>{{ task.title }}</strong>
                        {% if task.description %}
                        <br><small style="color: #7b7268;">{{ task.description|truncatewords:10 }}</small>
                        {% endif %}
                    </td>
                    <td style="padding: 10px;">{{ task.get_task_type_display }}</td>
                    <td style="padding: 10px;">
                        <span style="padding: 3px 8px; border-radius: 3px; font-size: 0.8em; background-color:
                            {% if task.priority == 'high' %}#D9CFC7{% elif task.priority == 'medium' %}#EFE9E3{% else %}#F9F8F6{% endif %}">
                            {{ task.get_priority_display }}
                        </span>
                    </td>
                    <td style="padding: 10px;">
                        <span style="padding: 3px 8px; border-radius: 3px; font-size: 0.8em; background-color:
                            {% if task.status == 'pending' %}#EFE9E3{% elif task.status == 'in_progress' %}#F9F8F6{% else %}#D9CFC7{% endif %}">
                            {{ task.get_status_display }}
                        </span>
                    </td>
                    <td style="padding: 10px;">
                        {% if task.due_date %}
                        <span {% if task.due_date < today and task.status != 'completed' %}style="color: #C9B59C; font-weight: bold;"{% endif %}>
                            {{ task.due_date|date:"d/m/Y" }}
                        </span>
                        {% else %}
                        <span style="color: #7b7268;">None</span>
                        {% endif %}
                    </td>
                    <td style="padding: 10px;">
                        <div style="display: flex; gap: 5px;">
                            <a href="{% url 'tasks:task_update' task.pk %}" class="btn" style="font-size: 0.85em;">Edit</a>
                            <a href="{% url 'tasks:task_delete' task.pk %}" class="btn btn-danger" style="font-size: 0.85em;">Delete</a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% else %}
    <div class="card">
        <p>No tasks found.</p>
    </div>
{% endif %}
{% endblock %}
