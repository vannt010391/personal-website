{% extends 'base.html' %}
{% load static %}
{% load knowledge_extras %}

{% block title %}{{ entry.title }} - Kiáº¿n Thá»©c{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/gitbook-style.css' %}">
<link rel="stylesheet" href="{% static 'css/code-highlight.css' %}">
{% endblock %}

{% block content %}
<div class="gitbook-container">
    <!-- Left Sidebar -->
    <aside class="gitbook-sidebar">
        <h3>ğŸ“š Chá»§ Ä‘á»</h3>
        {% if entry.topic %}
        <div class="gitbook-sidebar-item" style="background: #D9CFC7; color: #3f372f;">
            ğŸ“Œ {{ entry.topic.name }}
        </div>
        {% endif %}

        <h3>ğŸ“„ Pages</h3>
        {% if entry.parent or sibling_pages %}
            {% if entry.parent %}
                <a href="{% url 'knowledge:entry_detail' entry.parent.slug %}" class="gitbook-sidebar-item">
                    â† {{ entry.parent.title }}
                </a>
                <div style="padding-left: 15px;">
                    {% for child in entry.parent.children.all %}
                        <a href="{% url 'knowledge:entry_detail' child.slug %}" 
                           class="gitbook-sidebar-item {% if child.id == entry.id %}active{% endif %}">
                            {{ child.title|truncatewords:3 }}
                        </a>
                    {% endfor %}
                </div>
            {% else %}
                {% for page in sibling_pages %}
                    <a href="{% url 'knowledge:entry_detail' page.slug %}" class="gitbook-sidebar-item">
                        {{ page.title|truncatewords:3 }}
                    </a>
                {% endfor %}
            {% endif %}
        {% endif %}

        <h3>âš™ï¸ Quáº£n lÃ½</h3>
        <a href="{% url 'knowledge:entry_list' %}" class="gitbook-sidebar-item">â† Danh sÃ¡ch</a>
        <a href="{% url 'knowledge:entry_update' entry.slug %}" class="gitbook-sidebar-item">âœï¸ Chá»‰nh sá»­a</a>
        <a href="{% url 'knowledge:entry_delete' entry.slug %}" class="gitbook-sidebar-item" onclick="return confirm('Báº¡n cháº¯c cháº¯n?')">ğŸ—‘ï¸ XÃ³a</a>
    </aside>

    <!-- Main Content -->
    <main class="gitbook-main" style="max-width: 900px; margin: 0 auto; padding: 40px 60px;">
        <!-- Breadcrumb - Minimal -->
        <div style="margin-bottom: 30px; font-size: 0.85rem; color: #7b7268;">
            <a href="{% url 'knowledge:entry_list' %}" style="color: #7b7268; text-decoration: none; transition: color 0.2s;">Kiáº¿n Thá»©c</a>
            {% if entry.topic %} <span style="color: #D9CFC7;">â€º</span> <a href="?topic={{ entry.topic.id }}" style="color: #7b7268; text-decoration: none;">{{ entry.topic.name }}</a>{% endif %}
            {% if entry.parent %} <span style="color: #D9CFC7;">â€º</span> <a href="{% url 'knowledge:entry_detail' entry.parent.slug %}" style="color: #7b7268; text-decoration: none;">{{ entry.parent.title|truncatewords:5 }}</a>{% endif %}
        </div>

        <!-- Title - Large and Clean -->
        <h1 style="font-size: 3rem; font-weight: 700; margin: 0 0 15px 0; color: #3f372f; line-height: 1.2;">
            {{ entry.title }}{% if entry.is_favorite %} <span style="color: #C9B59C;">â­</span>{% endif %}
        </h1>

        <!-- Summary - Minimal if present -->
        {% if entry.summary %}
        <p style="font-size: 1.1rem; color: #7b7268; margin: 0 0 30px 0; line-height: 1.6;">
            {{ entry.summary }}
        </p>
        {% endif %}

        <!-- Meta Info - Very minimal -->
        <div style="display: flex; gap: 15px; margin-bottom: 40px; padding-bottom: 20px; border-bottom: 1px solid #EFE9E3; font-size: 0.85rem; color: #7b7268;">
            {% if entry.entry_type %}
            <span>{{ entry.get_entry_type_display }}</span>
            {% endif %}
            <span>â€¢</span>
            <span>{{ entry.updated_at|date:"d/m/Y" }}</span>
            {% if entry.tags %}
            <span>â€¢</span>
            <span>
                {% for tag in entry.tags|split:"," %}
                    #{{ tag|trim }}{% if not forloop.last %}, {% endif %}
                {% endfor %}
            </span>
            {% endif %}
        </div>

        <!-- Children Pages as Cards (if this is a parent page) -->
        {% if entry.children.all %}
        <div style="margin-bottom: 50px;">
            <p style="color: #7b7268; font-size: 0.95rem; margin-bottom: 20px;">CÃ¡c trang trong pháº§n nÃ y:</p>
            <div style="display: grid; gap: 15px;">
                {% for child in entry.children.all %}
                <a href="{% url 'knowledge:entry_detail' child.slug %}"
                   style="display: flex; align-items: center; gap: 15px; padding: 20px; background: white; border: 1px solid #EFE9E3; border-radius: 8px; text-decoration: none; transition: all 0.2s;"
                   onmouseover="this.style.borderColor='#C9B59C'; this.style.transform='translateX(5px)';"
                   onmouseout="this.style.borderColor='#EFE9E3'; this.style.transform='translateX(0)';">
                    <div style="font-size: 1.5rem;">ğŸ“„</div>
                    <div>
                        <div style="font-weight: 600; color: #3f372f; margin-bottom: 4px;">{{ child.title }}</div>
                        {% if child.summary %}
                        <div style="font-size: 0.9rem; color: #7b7268;">{{ child.summary|truncatewords:15 }}</div>
                        {% endif %}
                    </div>
                </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Main Article Content -->
        <article class="gitbook-content" style="margin-bottom: 50px;">
            {{ content_html|safe }}
        </article>

        <!-- Source URL - Minimal -->
        {% if entry.source_url %}
        <div style="margin: 40px 0; padding: 15px 20px; background: #F9F8F6; border-radius: 6px;">
            <div style="font-size: 0.85rem; color: #7b7268; margin-bottom: 6px;">ğŸ“š Nguá»“n tham kháº£o</div>
            <a href="{{ entry.source_url }}" target="_blank" style="color: #C9B59C; text-decoration: none; word-break: break-all; font-size: 0.9rem;">
                {{ entry.source_url }}
            </a>
        </div>
        {% endif %}

        <!-- Edit Button - Floating at bottom -->
        <div style="margin-top: 60px; padding-top: 30px; border-top: 1px solid #EFE9E3;">
            <a href="{% url 'knowledge:entry_update' entry.slug %}"
               style="display: inline-flex; align-items: center; gap: 8px; padding: 10px 20px; background: #F9F8F6; color: #7b7268; border: 1px solid #D9CFC7; border-radius: 6px; text-decoration: none; font-size: 0.9rem; transition: all 0.2s;"
               onmouseover="this.style.background='#EFE9E3';"
               onmouseout="this.style.background='#F9F8F6';">
                âœï¸ Chá»‰nh sá»­a trang nÃ y
            </a>
        </div>
    </main>
</div>

<style>
    .gitbook-content {
        line-height: 1.8;
        color: #3f372f;
    }

    .gitbook-content h1 {
        font-size: 2rem;
        margin: 40px 0 20px 0;
        padding-bottom: 10px;
        border-bottom: 2px solid #D9CFC7;
    }

    .gitbook-content h2 {
        font-size: 1.6rem;
        margin: 35px 0 15px 0;
        color: #3f372f;
    }

    .gitbook-content h3 {
        font-size: 1.3rem;
        margin: 25px 0 12px 0;
        color: #3f372f;
    }

    .gitbook-content h4, .gitbook-content h5, .gitbook-content h6 {
        margin: 20px 0 10px 0;
        color: #3f372f;
    }

    .gitbook-content p {
        margin: 15px 0;
    }

    .gitbook-content ul, .gitbook-content ol {
        margin: 15px 0;
        padding-left: 30px;
    }

    .gitbook-content li {
        margin: 8px 0;
    }

    .gitbook-content code {
        background: #F9F8F6;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: 'Courier New', monospace;
        color: #C9B59C;
    }

    .gitbook-content pre {
        background: #3f372f;
        color: #F9F8F6;
        padding: 20px;
        border-radius: 8px;
        overflow-x: auto;
        margin: 20px 0;
    }

    .gitbook-content pre code {
        background: none;
        padding: 0;
        color: #F9F8F6;
    }

    .gitbook-content blockquote {
        border-left: 4px solid #C9B59C;
        padding-left: 20px;
        margin: 20px 0;
        color: #7b7268;
        font-style: italic;
    }

    .gitbook-content table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
    }

    .gitbook-content table th {
        background: #D9CFC7;
        color: #3f372f;
        padding: 12px;
        text-align: left;
    }

    .gitbook-content table td {
        border: 1px solid #D9CFC7;
        padding: 12px;
    }

    .gitbook-content table tr:nth-child(even) {
        background: #F9F8F6;
    }

    .gitbook-content a {
        color: #C9B59C;
        text-decoration: none;
        transition: color 0.2s;
    }

    .gitbook-content a:hover {
        color: #3f372f;
        text-decoration: underline;
    }

    @media (max-width: 1024px) {
        .gitbook-container > aside:last-child {
            display: none;
        }
    }
</style>
{% endblock %}
