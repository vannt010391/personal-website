{% extends 'base.html' %}
{% load static %}
{% load knowledge_tree %}

{% block title %}{% if object %}Ch·ªânh s·ª≠a{% else %}T·∫°o m·ªõi{% endif %} Entry{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/forms.css' %}">
<link rel="stylesheet" href="{% static 'css/gitbook-style.css' %}">
{% endblock %}

{% block content %}
<div class="gitbook-container">
    <!-- Sidebar Navigation -->
    <aside class="gitbook-sidebar">
        <h3>üìö Ch·ªß ƒë·ªÅ</h3>
        {% if topics %}
            {% for topic in topics %}
            <a href="{% url 'knowledge:entry_create' %}?topic={{ topic.id }}"
               class="gitbook-sidebar-item {% if selected_topic_id == topic.id|stringformat:'s' %}active{% endif %}">
                üìå {{ topic.name }}
            </a>
            {% endfor %}
        {% else %}
            <span class="gitbook-sidebar-item">Ch∆∞a c√≥ ch·ªß ƒë·ªÅ</span>
        {% endif %}

        <h3>üìÑ Pages</h3>
        {% if sidebar_entries %}
            {% entry_tree sidebar_entries current_slug=object.slug %}
        {% else %}
            <span class="gitbook-sidebar-item">Ch∆∞a c√≥ trang</span>
        {% endif %}

        <h3>‚öôÔ∏è Qu·∫£n l√Ω</h3>
        <a href="{% url 'knowledge:entry_list' %}" class="gitbook-sidebar-item">‚Üê Danh s√°ch</a>
        <a href="{% url 'knowledge:topic_create' %}" class="gitbook-sidebar-item">üóÇÔ∏è T·∫°o ch·ªß ƒë·ªÅ</a>
        <a href="{% url 'knowledge:topic_list' %}" class="gitbook-sidebar-item">üìÇ Qu·∫£n l√Ω ch·ªß ƒë·ªÅ</a>
    </aside>

    <!-- Main Content -->
    <main class="gitbook-main">
        <div class="gitbook-header">
            <div>
                <h1 class="gitbook-title">{% if object %}Ch·ªânh s·ª≠a page{% else %}T·∫°o page m·ªõi{% endif %}</h1>
                <p style="color: #7b7268; margin: 0;">So·∫°n th·∫£o n·ªôi dung theo c·∫•u tr√∫c t√†i li·ªáu GitBook.</p>
            </div>
            {% if selected_topic_id %}
            <a href="{% url 'knowledge:entry_create' %}?topic={{ selected_topic_id }}"
               style="padding: 10px 18px; background: #C9B59C; color: white; border-radius: 6px; text-decoration: none; font-weight: 600;">
                ‚ûï Page m·ªõi
            </a>
            {% endif %}
        </div>

        <form method="post">
            {% csrf_token %}

            <div class="form-group">
                <label for="{{ form.title.id_for_label }}" class="form-label">Ti√™u ƒë·ªÅ *</label>
                {{ form.title }}
            </div>

            <div class="form-group">
                <label for="{{ form.slug.id_for_label }}" class="form-label">Slug *</label>
                {{ form.slug }}
                <small class="form-help">{{ form.slug.help_text }}</small>
            </div>

            <div class="form-group">
                <label for="{{ form.topic.id_for_label }}" class="form-label">Ch·ªß ƒë·ªÅ</label>
                {{ form.topic }}
            </div>

            <div class="form-group">
                <label for="{{ form.parent.id_for_label }}" class="form-label">Trang cha</label>
                {{ form.parent }}
                <small class="form-help">D√πng ƒë·ªÉ t·∫°o m·ª•c l·ª•c nhi·ªÅu c·∫•p</small>
            </div>

            <div class="form-group">
                <label for="{{ form.order.id_for_label }}" class="form-label">Th·ª© t·ª±</label>
                {{ form.order }}
                <small class="form-help">S·ªë nh·ªè s·∫Ω hi·ªÉn th·ªã tr∆∞·ªõc</small>
            </div>

            <div class="form-group">
                <label for="{{ form.entry_type.id_for_label }}" class="form-label">Lo·∫°i *</label>
                {{ form.entry_type }}
            </div>

            <div class="form-group">
                <label for="{{ form.summary.id_for_label }}" class="form-label">T√≥m t·∫Øt</label>
                {{ form.summary }}
            </div>

            <div class="form-group">
                <label for="{{ form.content.id_for_label }}" class="form-label">N·ªôi dung * (Markdown)</label>
                {{ form.content }}
                <small class="form-help">H·ªó tr·ª£ Markdown: # Heading, **bold**, `code`, etc.</small>
            </div>

            <div class="form-group">
                <label for="{{ form.source_url.id_for_label }}" class="form-label">Ngu·ªìn URL</label>
                {{ form.source_url }}
            </div>

            <div class="form-group">
                <label for="{{ form.tags.id_for_label }}" class="form-label">Tags</label>
                {{ form.tags }}
                <small class="form-help">Ph√¢n c√°ch b·∫±ng d·∫•u ph·∫©y</small>
            </div>

            <div class="form-group">
                <label style="display: flex; align-items: center; gap: 8px;">
                    {{ form.is_favorite }}
                    <span>ƒê√°nh d·∫•u y√™u th√≠ch</span>
                </label>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn-form-primary">
                    {% if object %}C·∫≠p nh·∫≠t{% else %}T·∫°o m·ªõi{% endif %}
                </button>
                <a href="{% url 'knowledge:entry_list' %}" class="btn-form-secondary">H·ªßy</a>
            </div>
        </form>
    </main>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/slug-generator.js' %}"></script>
{% endblock %}
