{% extends 'base.html' %}
{% load knowledge_extras %}
{% load static %}

{% block title %}Ki·∫øn Th·ª©c{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/gitbook-style.css' %}">
{% endblock %}

{% block content %}
<div class="gitbook-container">
    <!-- Sidebar Navigation -->
    <aside class="gitbook-sidebar">
        <!-- Search Box -->
        <form method="get" action="{% url 'knowledge:search' %}" style="margin-bottom: 25px;">
            <input 
                type="text" 
                name="q" 
                placeholder="T√¨m ki·∫øm..." 
                style="width: 100%; padding: 10px; border: 2px solid #D9CFC7; border-radius: 6px; font-size: 0.95rem; transition: border-color 0.2s;"
                onfocus="this.style.borderColor='#C9B59C'"
                onblur="this.style.borderColor='#D9CFC7'"
            />
        </form>

        <h3>üîó Ch·ªß ƒë·ªÅ</h3>
        <a href="?" class="gitbook-sidebar-item {% if not request.GET.topic %}active{% endif %}">
            üìö T·∫•t c·∫£
        </a>
        {% if topics %}
            {% for topic in topics %}
            <a href="?topic={{ topic.id }}" class="gitbook-sidebar-item {% if request.GET.topic == topic.id|stringformat:'s' %}active{% endif %}">
                üìå {{ topic.name }}
            </a>
            {% endfor %}
        {% endif %}

        <h3>üè∑Ô∏è Lo·∫°i</h3>
        <a href="?" class="gitbook-sidebar-item {% if not request.GET.type %}active{% endif %}">T·∫•t c·∫£</a>
        <a href="?type=note" class="gitbook-sidebar-item {% if request.GET.type == 'note' %}active{% endif %}">Ghi ch√∫</a>
        <a href="?type=research" class="gitbook-sidebar-item {% if request.GET.type == 'research' %}active{% endif %}">Nghi√™n c·ª©u</a>
        <a href="?type=article" class="gitbook-sidebar-item {% if request.GET.type == 'article' %}active{% endif %}">B√†i vi·∫øt</a>
        <a href="?type=reference" class="gitbook-sidebar-item {% if request.GET.type == 'reference' %}active{% endif %}">Tham kh·∫£o</a>

        <h3>‚≠ê Y√™u th√≠ch</h3>
        <a href="?favorite=true" class="gitbook-sidebar-item">Ghi ch√∫ y√™u th√≠ch</a>

        <h3>‚öôÔ∏è Qu·∫£n l√Ω</h3>
        <a href="{% url 'knowledge:entry_create' %}" class="gitbook-sidebar-item">‚ûï T·∫°o ghi ch√∫</a>
        <a href="{% url 'knowledge:topic_create' %}" class="gitbook-sidebar-item">üóÇÔ∏è T·∫°o ch·ªß ƒë·ªÅ</a>
        <a href="{% url 'knowledge:topic_list' %}" class="gitbook-sidebar-item">üìÇ Qu·∫£n l√Ω ch·ªß ƒë·ªÅ</a>
    </aside>

    <!-- Main Content -->
    <main class="gitbook-main" style="max-width: 900px; margin: 0 auto; padding: 40px 60px;">
        <div style="margin-bottom: 40px;">
            <h1 style="font-size: 2.5rem; font-weight: 700; margin: 0 0 8px 0; color: #3f372f;">Kho Ki·∫øn Th·ª©c</h1>
            <p style="color: #7b7268; margin: 0; font-size: 1rem;">L∆∞u tr·ªØ v√† qu·∫£n l√Ω c√°c ghi ch√∫, nghi√™n c·ª©u c·ªßa b·∫°n</p>
        </div>

        {% if entries %}
            <div style="display: grid; gap: 2px; background: #EFE9E3; border-radius: 8px; overflow: hidden;">
                {% for entry in entries %}
                <a href="{% url 'knowledge:entry_detail' entry.slug %}"
                   style="display: block; padding: 20px 24px; background: white; text-decoration: none; transition: all 0.2s; border-left: 3px solid transparent;"
                   onmouseover="this.style.background='#F9F8F6'; this.style.borderLeftColor='#C9B59C'; this.style.paddingLeft='28px';"
                   onmouseout="this.style.background='white'; this.style.borderLeftColor='transparent'; this.style.paddingLeft='24px';">

                    <!-- Title and Star -->
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 6px;">
                        <h2 style="margin: 0; font-size: 1.3rem; font-weight: 600; color: #3f372f; flex: 1;">
                            {{ entry.title }}
                        </h2>
                        {% if entry.is_favorite %}
                        <span style="color: #C9B59C; font-size: 1.1rem;">‚≠ê</span>
                        {% endif %}
                    </div>

                    <!-- Summary -->
                    {% if entry.summary %}
                    <p style="color: #7b7268; margin: 6px 0 12px 0; line-height: 1.5; font-size: 0.95rem;">
                        {{ entry.summary|truncatewords:20 }}
                    </p>
                    {% endif %}

                    <!-- Meta Info - Minimal -->
                    <div style="display: flex; gap: 12px; align-items: center; font-size: 0.85rem; color: #7b7268;">
                        {% if entry.topic %}
                        <span>üìå {{ entry.topic.name }}</span>
                        <span>‚Ä¢</span>
                        {% endif %}
                        <span>{{ entry.get_entry_type_display }}</span>
                        <span>‚Ä¢</span>
                        <span>{{ entry.updated_at|date:"d/m/Y" }}</span>
                        {% if entry.tags %}
                        <span>‚Ä¢</span>
                        <span>
                            {% for tag in entry.tags|split:"," %}
                                #{{ tag|trim }}{% if not forloop.last %}, {% endif %}
                            {% endfor %}
                        </span>
                        {% endif %}
                    </div>
                </a>
                {% endfor %}
            </div>

            {% if is_paginated %}
            <div style="margin-top: 40px; padding-top: 30px; border-top: 1px solid #EFE9E3;">
                <div style="display: flex; gap: 10px; justify-content: center; align-items: center;">
                    {% if page_obj.has_previous %}
                        <a href="?page={{ page_obj.previous_page_number }}"
                           style="padding: 8px 16px; background: #F9F8F6; color: #7b7268; border-radius: 6px; text-decoration: none; font-size: 0.9rem; transition: background 0.2s;"
                           onmouseover="this.style.background='#EFE9E3';"
                           onmouseout="this.style.background='#F9F8F6';">
                            ‚Üê Tr∆∞·ªõc
                        </a>
                    {% endif %}

                    <span style="padding: 8px 16px; color: #7b7268; font-size: 0.9rem;">
                        Trang {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}
                    </span>

                    {% if page_obj.has_next %}
                        <a href="?page={{ page_obj.next_page_number }}"
                           style="padding: 8px 16px; background: #F9F8F6; color: #7b7268; border-radius: 6px; text-decoration: none; font-size: 0.9rem; transition: background 0.2s;"
                           onmouseover="this.style.background='#EFE9E3';"
                           onmouseout="this.style.background='#F9F8F6';">
                            Ti·∫øp ‚Üí
                        </a>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        {% else %}
            <div style="text-align: center; padding: 80px 20px;">
                <div style="font-size: 3rem; margin-bottom: 20px;">üìö</div>
                <p style="font-size: 1.2rem; color: #7b7268; margin-bottom: 30px;">Ch∆∞a c√≥ ghi ch√∫ n√†o</p>
                <a href="{% url 'knowledge:entry_create' %}"
                   style="padding: 12px 30px; background: #C9B59C; color: white; border-radius: 6px; text-decoration: none; font-weight: 600; display: inline-block; transition: background 0.2s;"
                   onmouseover="this.style.background='#B8A58B';"
                   onmouseout="this.style.background='#C9B59C';">
                    ‚ú® T·∫°o ghi ch√∫ ƒë·∫ßu ti√™n
                </a>
            </div>
        {% endif %}
    </main>
</div>
{% endblock %}
