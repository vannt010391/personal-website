{% extends 'base.html' %}
{% load knowledge_extras %}
{% load static %}

{% block title %}Kiáº¿n Thá»©c{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/gitbook-style.css' %}">
{% endblock %}

{% block content %}
<div class="gitbook-container">
    <!-- Sidebar Navigation -->
    <aside class="gitbook-sidebar">
        <!-- Search Box -->
        <form method="get" action="{% url 'knowledge:search' %}" style="margin-bottom: 25px;">
            <input 
                type="text" 
                name="q" 
                placeholder="TÃ¬m kiáº¿m..." 
                style="width: 100%; padding: 10px; border: 2px solid #D9CFC7; border-radius: 6px; font-size: 0.95rem; transition: border-color 0.2s;"
                onfocus="this.style.borderColor='#C9B59C'"
                onblur="this.style.borderColor='#D9CFC7'"
            />
        </form>

        <h3>ğŸ”— Chá»§ Ä‘á»</h3>
        <a href="?" class="gitbook-sidebar-item {% if not request.GET.topic %}active{% endif %}">
            ğŸ“š Táº¥t cáº£
        </a>
        {% if topics %}
            {% for topic in topics %}
            <a href="?topic={{ topic.id }}" class="gitbook-sidebar-item {% if request.GET.topic == topic.id|stringformat:'s' %}active{% endif %}">
                ğŸ“Œ {{ topic.name }}
            </a>
            {% endfor %}
        {% endif %}

        <h3>ğŸ·ï¸ Loáº¡i</h3>
        <a href="?" class="gitbook-sidebar-item {% if not request.GET.type %}active{% endif %}">Táº¥t cáº£</a>
        <a href="?type=note" class="gitbook-sidebar-item {% if request.GET.type == 'note' %}active{% endif %}">Ghi chÃº</a>
        <a href="?type=research" class="gitbook-sidebar-item {% if request.GET.type == 'research' %}active{% endif %}">NghiÃªn cá»©u</a>
        <a href="?type=article" class="gitbook-sidebar-item {% if request.GET.type == 'article' %}active{% endif %}">BÃ i viáº¿t</a>
        <a href="?type=reference" class="gitbook-sidebar-item {% if request.GET.type == 'reference' %}active{% endif %}">Tham kháº£o</a>

        <h3>â­ YÃªu thÃ­ch</h3>
        <a href="?favorite=true" class="gitbook-sidebar-item">Ghi chÃº yÃªu thÃ­ch</a>

        <h3>âš™ï¸ Quáº£n lÃ½</h3>
        <a href="{% url 'knowledge:entry_create' %}" class="gitbook-sidebar-item">â• Táº¡o ghi chÃº</a>
        <a href="{% url 'knowledge:topic_create' %}" class="gitbook-sidebar-item">ğŸ—‚ï¸ Táº¡o chá»§ Ä‘á»</a>
        <a href="{% url 'knowledge:topic_list' %}" class="gitbook-sidebar-item">ğŸ“‚ Quáº£n lÃ½ chá»§ Ä‘á»</a>
    </aside>

    <!-- Main Content -->
    <main class="gitbook-main">
        <div class="gitbook-header">
            <div>
                <h1 class="gitbook-title">Kho Kiáº¿n Thá»©c</h1>
                <p style="color: #7b7268; margin: 0;">LÆ°u trá»¯ vÃ  quáº£n lÃ½ cÃ¡c ghi chÃº, nghiÃªn cá»©u cá»§a báº¡n</p>
            </div>
            <a href="{% url 'knowledge:entry_create' %}" style="padding: 12px 24px; background: linear-gradient(135deg, #C9B59C 0%, #D9CFC7 100%); color: white; border-radius: 6px; text-decoration: none; font-weight: 600; white-space: nowrap;">
                â• ThÃªm ghi chÃº
            </a>
        </div>

        {% if entries %}
            <div style="display: grid; gap: 20px;">
                {% for entry in entries %}
                <div style="padding: 20px; border: 1px solid #D9CFC7; border-radius: 8px; transition: all 0.3s; hover-shadow: 0 4px 12px rgba(0,0,0,0.05);">
                    <div style="display: flex; justify-content: space-between; align-items: start; gap: 15px;">
                        <div style="flex: 1;">
                            <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 10px;">
                                <span style="padding: 4px 10px; background: linear-gradient(135deg, rgba(201, 181, 156, 0.1) 0%, rgba(217, 207, 199, 0.1) 100%); color: #C9B59C; border-radius: 4px; font-size: 0.8rem; font-weight: 600;">
                                    {{ entry.get_entry_type_display }}
                                </span>
                                {% if entry.is_favorite %}
                                <span style="font-size: 1.2rem;">â­</span>
                                {% endif %}
                                {% if entry.topic %}
                                <span style="padding: 4px 10px; background: #EFE9E3; color: #7b7268; border-radius: 4px; font-size: 0.8rem;">
                                    ğŸ“Œ {{ entry.topic.name }}
                                </span>
                                {% endif %}
                            </div>

                            <h2 style="margin: 0 0 10px 0; font-size: 1.4rem;">
                                <a href="{% url 'knowledge:entry_detail' entry.slug %}" style="color: #3f372f; text-decoration: none;">
                                    {{ entry.title }}
                                </a>
                            </h2>

                            {% if entry.summary %}
                            <p style="color: #7b7268; margin: 10px 0; line-height: 1.6;">
                                {{ entry.summary }}
                            </p>
                            {% endif %}

                            {% if entry.tags %}
                            <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-top: 12px;">
                                {% for tag in entry.tags|split:"," %}
                                <span style="padding: 3px 10px; background: #F9F8F6; color: #7b7268; border-radius: 12px; font-size: 0.85rem;">
                                    #{{ tag|trim }}
                                </span>
                                {% endfor %}
                            </div>
                            {% endif %}

                            <p style="color: #7b7268; font-size: 0.9rem; margin: 12px 0 0 0;">
                                ğŸ•’ {{ entry.updated_at|date:"d/m/Y H:i" }}
                            </p>
                        </div>
                        <a href="{% url 'knowledge:entry_detail' entry.slug %}" style="padding: 10px 20px; background: #F9F8F6; color: #C9B59C; border-radius: 6px; text-decoration: none; font-weight: 600; white-space: nowrap; transition: all 0.2s;">
                            Xem â†’
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>

            {% if is_paginated %}
            <div style="text-align: center; margin-top: 40px; padding-top: 30px; border-top: 1px solid #D9CFC7;">
                <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                    {% if page_obj.has_previous %}
                        <a href="?page=1" class="gitbook-nav-button">Â« Äáº§u</a>
                        <a href="?page={{ page_obj.previous_page_number }}" class="gitbook-nav-button">â€¹ TrÆ°á»›c</a>
                    {% endif %}

                    <span style="padding: 10px 15px; color: #7b7268;">
                        Trang {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}
                    </span>

                    {% if page_obj.has_next %}
                        <a href="?page={{ page_obj.next_page_number }}" class="gitbook-nav-button">Tiáº¿p â€º</a>
                        <a href="?page={{ page_obj.paginator.num_pages }}" class="gitbook-nav-button">Cuá»‘i Â»</a>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        {% else %}
            <div style="text-align: center; padding: 60px 20px;">
                <p style="font-size: 1.2rem; color: #7b7268; margin-bottom: 20px;">ğŸ“š KhÃ´ng cÃ³ ghi chÃº nÃ o</p>
                <a href="{% url 'knowledge:entry_create' %}" style="padding: 12px 24px; background: linear-gradient(135deg, #C9B59C 0%, #D9CFC7 100%); color: white; border-radius: 6px; text-decoration: none; font-weight: 600; display: inline-block;">
                    â• Táº¡o ghi chÃº Ä‘áº§u tiÃªn
                </a>
            </div>
        {% endif %}
    </main>
</div>
{% endblock %}
